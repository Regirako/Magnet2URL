<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Redirecionando Magnet</title>

    <!-- Metadados para legibilidade e credibilidade -->
    <meta name="description" content="Magnet2URL — ferramenta open-source que redireciona magnet links para o cliente de torrent local. Nenhum dado é coletado pelo site e nenhum arquivo é hospedado ou transferido por este servidor." />
    <meta name="author" content="Regirako" />
    <meta name="robots" content="index, follow" />
    <meta name="referrer" content="no-referrer" />

    <!-- Segurança: impede sniffing de tipo e declara política de conteúdo -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <!-- Content-Security-Policy via meta (útil quando não há controle do servidor): restringe recursos externos -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data:;
      media-src 'self' blob:;
      connect-src 'none';
      frame-ancestors 'none';
      object-src 'none';
      base-uri 'self';
    " />

    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        text-align: center;
        padding: 2em;
        background-color: #f5f5f5;
        position: relative;
        margin: 0;
      }
      h1, h2, p {
        color: #333;
      }
      button {
        padding: 12px 24px;
        font-size: 1em;
        border: none;
        background-color: #2e7d32;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }
      button:hover {
        background-color: #1b5e20;
        transform: scale(1.05);
      }
      .music-btn {
        background-color: #d55901;
      }
      .music-btn:hover {
        background-color: #842e03;
      }
      .footer-banner {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40px;
        background: rgba(51, 51, 51, 0.2);
        overflow: hidden;
        display: flex;
        align-items: center;
        z-index: 10;
      }
      .footer-banner span {
        white-space: nowrap;
        display: inline-block;
        padding-left: 100%;
        animation: slide-left 50s linear infinite;
        color: #333;
        font-size: 14px;
        font-weight: bold;
      }
      @keyframes slide-left {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
      }
      .regirako {
        position: fixed;
        bottom: 60px;
        right: 20px;
        height: 600px;
        opacity: 0.5;
        z-index: 5;
        transform-origin: center center;
        pointer-events: none;
      }

      /* Box de segurança (gradiente, borda arredondada, sombra e animação suave) */
      .secure-box {
        max-width: 700px;
        margin: 26px auto 0 auto;
        padding: 20px 22px;
        border-radius: 14px;
        background: linear-gradient(135deg, #c8f7c5 0%, #57a63a 100%);
        box-shadow: 0 10px 25px rgba(68, 120, 45, 0.18);
        animation: boxFloat 3s ease-in-out infinite alternate;
        color: #083109;
        text-align: left;
      }
      .secure-box h2 {
        margin: 0 0 8px 0;
        font-size: 20px;
        text-align: center;
        letter-spacing: 1px;
      }
      .secure-box p {
        font-size: 15px;
        line-height: 1.45;
        margin: 0;
        text-align: center;
      }
      @keyframes boxFloat {
        0% { transform: translateY(0); }
        100% { transform: translateY(-6px); }
      }

      /* Responsividade simples */
      @media (max-width: 640px) {
        .secure-box { padding: 16px; margin: 18px 12px 0 12px; }
        .regirako { height: 360px; right: 8px; bottom: 50px; }
      }
    </style>

    <script>
      /* ===== Variáveis e funções mantidas ===== */
      let magnetLink = "";
      let audio;
      let context, analyser, source;
      let regirakoImg;

      const musicList = [
        'assets/tokyo.mp3',
        'assets/mafland.mp3',
        'assets/xuliana.mp3',
        'assets/kenner.mp3'
      ];

      function getRandomMusic() {
        const index = Math.floor(Math.random() * musicList.length);
        return musicList[index];
      }

      function redirecionar() {
        if (magnetLink.startsWith("magnet:?")) {
          // abre o magnet no cliente local
          window.location.href = magnetLink;
        }
      }

      function toggleMusic() {
        if (!audio) return;

        if (audio.paused) {
          audio.play();
        } else {
          audio.pause();
        }
      }

      function animate() {
        if (!analyser || !regirakoImg) return;

        const data = new Uint8Array(analyser.frequencyBinCount);
        analyser.getByteFrequencyData(data);
        const average = data.reduce((a, b) => a + b, 0) / data.length;
        const scale = 1 + (average / 512) * 0.42;
        regirakoImg.style.transform = `scale(${scale})`;
        requestAnimationFrame(animate);
      }

      function setupAudioVisualizer() {
        try {
          context = new (window.AudioContext || window.webkitAudioContext)();
          analyser = context.createAnalyser();
          source = context.createMediaElementSource(audio);
          source.connect(analyser);
          analyser.connect(context.destination);
          animate();
        } catch (e) {
          // casos onde a API não está disponível ou bloqueada - ignora visualizador
          console.warn('Audio visualizer não disponível:', e);
        }
      }

      /* ===== Inicialização ===== */
      window.onload = () => {
        magnetLink = decodeURIComponent(window.location.hash.substring(1));

        if (magnetLink.startsWith("magnet:?")) {
          // comportamento original: tenta abrir imediatamente
          window.location.href = magnetLink;

          // se não for capturado, mostra fallback com explicações e botões (mantido)
          setTimeout(() => {
            const musicSrc = getRandomMusic();

            document.body.innerHTML = `
              <h1>Redirecionando para o cliente de torrent...</h1>

              <div class="secure-box" role="region" aria-label="Informações de segurança do site">
                <h2>MAGNET2URL</h2>
                <p>
                  Magnet2URL é um projeto open-source cujo único objetivo é encaminhar links no formato <strong>magnet:</strong> ao cliente de torrent local.
                  <br><br>
                  Não há coleta de dados de visitantes, não há alteração dos links magnet submetidos e nenhum arquivo é hospedado ou transferido por este servidor.
                  <br><br>
                  Esta página não realiza conexões remotas para armazenar ou processar seus links — todo processamento é local no navegador e o redirecionamento abre apenas o aplicativo cliente associado no computador do usuário.
                </p>
              </div>

              <h2>Você não foi redirecionado automaticamente?</h2>
              <p>
                Isso pode ocorrer se você não tiver um programa de gerenciamento de arquivos torrents para capturar <strong>Magnet Links</strong> instalado.<br><br>
                <strong>1.</strong> Baixe e instale o <a href='https://www.fosshub.com/qBittorrent.html' target='_blank' rel="noopener noreferrer"><strong>qBittorrent Windows 64x bits</strong></a>.<br>
                <strong>2.</strong> Durante a instalação, permita que ele seja o programa padrão para arquivos <strong>.torrent</strong> e <strong>Magnet Links</strong>.<br>
                <strong>3.</strong> Volte nesta página e clique no botão abaixo:
              </p>
              <button onclick="redirecionar()">Clique aqui para tentar novamente</button><br>
              <button class="music-btn" onclick="toggleMusic()">Music ON/OFF</button>

              <div class="footer-banner">
                <span><strong>Leia o que está escrito na página — é um tutorial de uso seguro para redirecionamento de Magnet Links.</strong></span>
              </div>

              <audio id="bg-audio" autoplay loop>
                <source src="${musicSrc}" type="audio/mpeg">
                Seu navegador não suporta o elemento de áudio.
              </audio>
              <img class="regirako" src="assets/regirako.png" alt="Regirako">
            `;

            audio = document.getElementById('bg-audio');
            regirakoImg = document.querySelector('.regirako');

            if (audio) {
              audio.onplay = () => {
                if (!context) {
                  setupAudioVisualizer();
                }
              };
            }
          }, 3000);
        } else {
          // sem magnet no hash: mostra a mensagem padrão + secure box
          document.body.innerHTML = `
            <h1>Redirecionando para o cliente de torrent...</h1>

            <div class="secure-box" role="region" aria-label="Informações de segurança do site">
              <h2>MAGNET2URL</h2>
              <p>
                Magnet2URL é um projeto open-source cujo único objetivo é encaminhar links no formato <strong>magnet:</strong> ao cliente de torrent local.
                <br><br>
                Não há coleta de dados de visitantes, não há alteração dos links magnet submetidos e nenhum arquivo é hospedado ou transferido por este servidor.
              </p>
            </div>

            <img class="regirako" src="assets/regirako.png" alt="Regirako">
          `;
        }
      };
    </script>
  </head>
  <body>
    <h1>Redirecionando para o cliente de torrent...</h1>

    <div class="secure-box" role="region" aria-label="Informações de segurança do site">
      <h2>MAGNET2URL</h2>
      <p>
        Magnet2URL é um projeto open-source cujo único objetivo é encaminhar links no formato <strong>magnet:</strong> ao cliente de torrent local.
        <br><br>
        Não há coleta de dados de visitantes, não há alteração dos links magnet submetidos e nenhum arquivo é hospedado ou transferido por este servidor.
      </p>
    </div>

    <img class="regirako" src="assets/regirako.png" alt="Regirako">
  </body>
</html>
