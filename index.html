<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Redirecionando Magnet</title>

  <!-- Metadados de credibilidade -->
  <meta name="description" content="Magnet2URL — ferramenta open-source que redireciona magnet links para o cliente de torrent local. Nenhum dado é coletado pelo site e nenhum arquivo é hospedado ou transferido por este servidor." />
  <meta name="author" content="Regirako" />
  <meta name="robots" content="index, follow" />
  <meta name="referrer" content="no-referrer" />

  <!-- Segurança -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data:;
    media-src 'self' blob:;
    connect-src 'none';
    frame-ancestors 'none';
    object-src 'none';
    base-uri 'self';
  " />

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 2em;
      background-color: #f5f5f5;
      margin: 0;
    }
    h1, h2, p {
      color: #333;
    }
    button {
      padding: 12px 24px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    button:hover {
      transform: scale(1.05);
    }
    .music-btn {
      background-color: #d55901;
      color: white;
    }
    .music-btn:hover {
      background-color: #842e03;
    }
    .footer-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40px;
      background: rgba(51, 51, 51, 0.2);
      overflow: hidden;
      display: flex;
      align-items: center;
      z-index: 10;
    }
    .footer-banner span {
      white-space: nowrap;
      display: inline-block;
      padding-left: 100%;
      animation: slide-left 50s linear infinite;
      color: #333;
      font-size: 14px;
      font-weight: bold;
    }
    @keyframes slide-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    .regirako {
      position: fixed;
      bottom: 60px;
      right: 20px;
      height: 600px;
      opacity: 0.5;
      z-index: 5;
      pointer-events: none;
    }

    /* Caixa de segurança */
    .secure-box {
      max-width: 700px;
      margin: 26px auto 0 auto;
      padding: 22px;
      border-radius: 14px;
      background: linear-gradient(135deg, #c8f7c5 0%, #57a63a 100%);
      box-shadow: 0 15px 30px rgba(68, 120, 45, 0.45);
      color: #083109;
      text-align: center;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      perspective: 1000px;
      animation: floatBox 3s ease-in-out infinite alternate;
    }
    @keyframes floatBox {
      0% { transform: translateY(0); }
      100% { transform: translateY(-6px); }
    }
    .secure-box h2 {
      margin: 0 0 8px 0;
      font-size: 20px;
      letter-spacing: 1px;
    }
    .secure-box p {
      font-size: 15px;
      line-height: 1.45;
      margin: 0;
    }

    @media (max-width: 640px) {
      .secure-box { padding: 16px; margin: 18px 12px 0 12px; }
      .regirako { height: 360px; right: 8px; bottom: 50px; }
    }
  </style>
</head>
<body>
  <h1>Redirecionando para o cliente de torrent...</h1>

  <div class="secure-box" role="region" aria-label="Informações de segurança do site">
    <h2>MAGNET2URL</h2>
    <p>
      Magnet2URL é um projeto open-source cujo único objetivo é encaminhar links no formato <strong>magnet:</strong> ao cliente de torrent local.<br>
      Não há coleta de dados de visitantes, não há alteração dos links magnet submetidos e nenhum arquivo é hospedado ou transferido por este servidor.
    </p>
  </div>

  <img class="regirako" src="assets/regirako.png" alt="Regirako">

  <script>
    let magnetLink = "";
    let audio;
    let context, analyser, source;
    let regirakoImg;

    const musicList = [
      'assets/tokyo.mp3',
      'assets/mafland.mp3',
      'assets/xuliana.mp3',
      'assets/kenner.mp3'
    ];

    function getRandomMusic() {
      const index = Math.floor(Math.random() * musicList.length);
      return musicList[index];
    }

    function redirecionar() {
      if (magnetLink.startsWith("magnet:?")) {
        window.location.href = magnetLink;
      }
    }

    function toggleMusic() {
      if (!audio) return;
      if (audio.paused) audio.play();
      else audio.pause();
    }

    function animate() {
      if (!analyser || !regirakoImg) return;
      const data = new Uint8Array(analyser.frequencyBinCount);
      analyser.getByteFrequencyData(data);
      const average = data.reduce((a,b)=>a+b,0)/data.length;
      const scale = 1 + (average / 512) * 0.42;
      regirakoImg.style.transform = `scale(${scale})`;
      requestAnimationFrame(animate);
    }

    function setupAudioVisualizer() {
      try {
        context = new (window.AudioContext || window.webkitAudioContext)();
        analyser = context.createAnalyser();
        source = context.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(context.destination);
        animate();
      } catch(e) { console.warn('Audio visualizer não disponível', e); }
    }

    /* Efeito tilt suave na caixa */
    const box = document.querySelector('.secure-box');
    if(box){
      box.addEventListener('mousemove', e=>{
        const rect = box.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width/2;
        const y = e.clientY - rect.top - rect.height/2;
        const rotateX = (y/rect.height)*6;
        const rotateY = (x/rect.width)*-6;
        box.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      });
      box.addEventListener('mouseleave', ()=>{
        box.style.transform = 'rotateX(0deg) rotateY(0deg)';
      });
    }

    /* Redirecionamento automático de magnet links */
    window.onload = ()=>{
      magnetLink = decodeURIComponent(window.location.hash.substring(1));
      if(magnetLink.startsWith("magnet:?")){
        window.location.href = magnetLink;

        setTimeout(()=>{
          const musicSrc = getRandomMusic();
          document.body.innerHTML += `
            <h2>Você não foi redirecionado automaticamente?</h2>
            <p>
              Isso pode ocorrer se você não tiver um programa de gerenciamento de arquivos torrents para capturar <strong>Magnet Links</strong> instalado.<br><br>
              <strong>1.</strong> Baixe e instale o <a href='https://www.fosshub.com/qBittorrent.html' target='_blank' rel="noopener noreferrer"><strong>qBittorrent</strong></a>.<br>
              <strong>2.</strong> Durante a instalação, permita que ele seja o programa padrão para arquivos <strong>.torrent</strong> e <strong>Magnet Links</strong>.<br>
              <strong>3.</strong> Volte nesta página e clique no botão abaixo:
            </p>
            <button onclick="redirecionar()">Abrir no gerenciador torrent?</button><br>
            <button class="music-btn" onclick="toggleMusic()">Music ON/OFF</button>
            <div class="footer-banner">
              <span><strong>Leia o tutorial de uso seguro para redirecionamento de Magnet Links.</strong></span>
            </div>
            <audio id="bg-audio" autoplay loop>
              <source src="${musicSrc}" type="audio/mpeg">
              Seu navegador não suporta o elemento de áudio.
            </audio>
            <img class="regirako" src="assets/regirako.png" alt="Regirako">
          `;
          audio = document.getElementById('bg-audio');
          regirakoImg = document.querySelector('.regirako');
          if(audio) audio.onplay = ()=>{ if(!context) setupAudioVisualizer(); };
        }, 3000);
      }
    };
  </script>
</body>
</html>
