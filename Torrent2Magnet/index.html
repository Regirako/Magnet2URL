<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Torrent2Magnet</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        text-align: center;
        padding: 2em;
        background-color: #f5f5f5;
        margin: 0;
      }

      h1, h2, p {
        color: #333;
      }

      input[type="file"] {
        padding: 10px;
        font-size: 1em;
      }

      .output {
        margin-top: 20px;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        display: inline-block;
        text-align: left;
      }

      .error {
        color: red;
        font-weight: bold;
        margin-top: 10px;
      }

      .footer-banner {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40px;
        background: rgba(51, 51, 51, 0.2);
        overflow: hidden;
        display: flex;
        align-items: center;
        z-index: 10;
      }

      .footer-banner span {
        white-space: nowrap;
        display: inline-block;
        padding-left: 100%;
        animation: slide-left 40s linear infinite;
        color: #333;
        font-size: 14px;
        font-weight: bold;
      }

      @keyframes slide-left {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
      }

      .regirako {
        position: fixed;
        bottom: 60px;
        right: 20px;
        height: 500px;
        opacity: 0.5;
        z-index: 5;
        pointer-events: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/webtorrent/bencode@master/lib/bencode.min.js"></script>
  </head>
  <body>
    <h1>Torrent2Magnet</h1>
    <p>Envie um arquivo <strong>.torrent</strong> para gerar o HASH e o Magnet Link.</p>
    <input type="file" id="torrentFile" accept=".torrent" />
    <div class="output" id="result"></div>
    <div class="error" id="errorConsole"></div>

    <div class="footer-banner">
      <span>Esta página converte arquivos .torrent locais para Magnet Links baseados em hash.</span>
    </div>
    <img class="regirako" src="../assets/regirako.png" alt="Regirako" />

    <script>
      const input = document.getElementById("torrentFile");
      const result = document.getElementById("result");
      const errorConsole = document.getElementById("errorConsole");

      input.addEventListener("change", async (event) => {
        errorConsole.textContent = "";
        result.innerHTML = "";

        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();

        reader.onload = function () {
          try {
            const arrayBuffer = reader.result;
            const uint8Array = new Uint8Array(arrayBuffer);
            const torrent = window.bencode.decode(uint8Array);

            const info = torrent.info;
            const name = info.name.toString();
            const encodedInfo = window.bencode.encode(info);

            // SHA-1 Hash
            crypto.subtle.digest("SHA-1", encodedInfo).then((hashBuffer) => {
              const hashArray = Array.from(new Uint8Array(hashBuffer));
              const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

              const magnet = `magnet:?xt=urn:btih:${hashHex}&dn=${encodeURIComponent(name)}`;
              const githubLink = `https://regirako.github.io/Magnet2URL/#${magnet}`;

              result.innerHTML = `
                <strong>HASH:</strong> ${hashHex}<br>
                <strong>NAME:</strong> ${name}<br><br>
                <strong>Magnet:</strong><br><code>${magnet}</code><br><br>
                <strong>Link para GitHub:</strong><br><a href="${githubLink}" target="_blank">${githubLink}</a>
              `;
            }).catch(err => {
              errorConsole.textContent = "❌ Erro ao calcular o hash.";
              console.error("Hash error:", err);
            });

          } catch (e) {
            errorConsole.textContent = "❌ Erro ao processar o arquivo .torrent.";
            console.error("Erro:", e);
          }
        };

        reader.onerror = function () {
          errorConsole.textContent = "❌ Erro ao ler o arquivo.";
        };

        reader.readAsArrayBuffer(file);
      });
    </script>
  </body>
</html>
